# TimeInventory アプリケーション仕様書

**バージョン**: 1.0.0
**最終更新日**: 2026-02-08

---

## 1. アプリケーション概要

### 1.1 目的
TimeInventoryは、「理想の1日（計画）」と「現実の1日（実績）」のギャップを可視化し、AIによる分析を通じて時間管理を改善するためのモバイルアプリケーションです。

### 1.2 ターゲットユーザー
- 時間管理を改善したい個人
- 生産性向上を目指すビジネスパーソン
- 自己分析・自己改善に関心のある学生

### 1.3 コア機能
- **24時間タイムライン表示**: 計画と実績を並べて視覚的に比較
- **AI分析機能**: 1日の振り返りをKPT形式で自動生成
- **カテゴリ管理**: 活動をカテゴリ別に色分けして管理
- **週間カレンダー**: スワイプ操作で日付を切り替え

### 1.4 対応プラットフォーム
- Android（API Level 24以上）
- iOS（iOS 15.0以上）

---

## 2. 画面構成

### 2.1 アプリケーション全体構造

```
┌─────────────────────────────────────┐
│         メイン画面領域               │
│   (タイムライン or レポート)         │
│                                     │
└─────────────────────────────────────┘
│  [Timeline] [Report]                │  ← ボトムナビゲーション
└─────────────────────────────────────┘
```

**ボトムナビゲーションバー**:
- **タイムライン**: 初期表示画面（アイコン: ViewTimeline）
- **レポート**: AI分析画面（アイコン: Analytics）

**画面遷移**:
- タブをタップして画面を切り替え
- 前の画面の状態を保持（スクロール位置など）

---

## 3. タイムライン画面仕様

### 3.1 画面レイアウト

```
┌─────────────────────────────────────┐
│ 📅 January 2026                     │  ← トップバー（月・年表示）
├─────────────────────────────────────┤
│  ← 週カレンダー（スワイプ可能）→    │
│   S   M   T   W   T   F   S         │
│  ①  ②  ③  ④  ⑤  ⑥  ⑦          │
├─────────────────────────────────────┤
│       │  Log     │  Schedule        │  ← カラムヘッダー
├───────┼──────────┼──────────────────┤
│ 00:00 │          │                  │
│ 01:00 │ [ブロック]│ [ブロック]       │
│ 02:00 │          │                  │
│  ...  │   ...    │    ...           │
│ 23:00 │          │                  │
└─────────────────────────────────────┘
```

### 3.2 トップバー

**表示内容**:
- 選択中の月名（例: "January", "February"）
- 年（現在年と異なる場合のみ表示、例: "2024"）

### 3.3 週カレンダー

**機能**:
- 7日分の日付を表示（日曜始まり）
- 左右スワイプで週を切り替え
- タップで日付を選択

**日付アイテムの表示**:
- 上段: 曜日の頭文字（S, M, T, W, T, F, S）
- 下段: 日付（1～31）

**視覚状態**:

| 状態 | 背景 | 日付色 | 曜日色 |
|------|------|--------|--------|
| 選択中（本日） | プライマリ色 | 白 | プライマリ色 |
| 選択中（他日） | グレー背景 | 黒 | グレー |
| 未選択（本日） | 透明 | 黒 | プライマリ色 |
| 未選択（他日） | 透明 | 黒 | グレー |

**アニメーション**:
- 選択時に拡大（スケール: 0.95 → 1.0）
- 背景色と文字色がスムーズに変化

### 3.4 タイムライングリッド

**3列構成**:

| 列 | 幅 | 内容 |
|----|-----|------|
| 時間列 | 56dp | 00:00～23:00の時刻ラベル |
| Log列 | 可変 | 実績ログ（LogEvent） |
| Schedule列 | 可変 | 計画イベント（PlannedEvent） |

**グリッド仕様**:
- 1時間あたりの高さ: 60dp
- 合計高さ: 1440dp（24時間 × 60dp）
- 縦スクロール可能

### 3.5 イベントブロック（TimeBlock）

**配置計算**:
- 垂直位置 = (時 × 60 + 分) × 1時間の高さ ÷ 60
- ブロック高さ = 期間（分） × 1時間の高さ ÷ 60
- 最小高さ: 8dp（短時間イベントも視認可能）

**例**: 08:30～10:15のイベント（105分間）
- 開始位置: (8 × 60 + 30) × 60 ÷ 60 = 510dp
- 高さ: 105 × 60 ÷ 60 = 105dp

**視覚デザイン**:
- 背景色: カテゴリ色（透明度30%）
- 左フチ: 濃いカテゴリ色の縦線（幅4dp）
- ラベル: 活動名を表示

**ラベル表示ルール**:

| イベント期間 | ラベル表示 | フォントサイズ | パディング |
|-------------|-----------|--------------|-----------|
| 20分未満 | 非表示 | - | - |
| 20～30分 | 表示 | 小 | なし |
| 30分以上 | 表示 | 中 | 上部2dp |

**操作**:
- **タップ**: イベント編集ボトムシートを開く
- **長押し**: 新規イベント作成ボトムシートを開く（押した時刻で初期化）

### 3.6 空きスロットの操作

**1時間スロットの長押し**:
- 背景色が薄く変化（プレス状態）
- 新規イベント作成ボトムシートが開く
- 開始時刻: 長押ししたスロットの時刻
- 終了時刻: 次の1時間後

### 3.7 イベント作成・編集ボトムシート

**4つのボトムシートタイプ**:
1. **ログ新規作成** (Create Log)
2. **予定新規作成** (Create Planned)
3. **ログ編集** (Edit Log)
4. **予定編集** (Edit Planned)

**ボトムシートレイアウト**:

```
┌────────────────────────────────────┐
│ Create New Event / Edit Event      │  ← タイトル
├────────────────────────────────────┤
│ Activity                           │
│ [                                ] │  ← テキスト入力
│ (e.g. Math study, Budget meeting) │
├────────────────────────────────────┤
│ Category                           │
│ [Work ▼]                           │  ← ドロップダウン
├────────────────────────────────────┤
│ Start Time      │ End Time         │
│ [08:30]         │ [10:00]          │  ← 時刻カード
├────────────────────────────────────┤
│ Memo                               │
│ [                                ] │  ← 複数行テキスト
│ [                                ] │
│ (Enter details or reflections...) │
├────────────────────────────────────┤
│ [Delete]              [Create/Save]│  ← ボタン
└────────────────────────────────────┘
```

**入力フィールド仕様**:

| フィールド | 入力形式 | 必須 | 初期値 | プレースホルダー |
|-----------|---------|------|--------|----------------|
| Activity | テキスト（1行） | ○ | 空 | "e.g. Math study, Budget meeting" |
| Category | ドロップダウン選択 | ○ | 先頭カテゴリ | - |
| Start Time | 時刻ピッカー | ○ | 指定時刻 | - |
| End Time | 時刻ピッカー | ○ | 指定時刻 | - |
| Memo | テキスト（複数行） | × | 空 | "Enter details or reflections..." |

**時刻ピッカー**:
- 時刻カードをタップすると時刻選択ダイアログが表示
- 時・分を個別に選択可能
- 選択後、カードの表示が更新される

**バリデーション**:
- Activity: 空白不可
- Category: 必ず選択必要
- Start Time < End Time: 開始時刻は終了時刻より前である必要
  - 違反時: 終了時刻が自動的に開始時刻と同じに調整される

**ボタン動作**:
- **Create/Save**:
  - バリデーション通過時のみ有効化
  - タップでイベントを保存してボトムシートを閉じる
- **Delete**:
  - 編集モード時のみ表示
  - タップでイベントを削除してボトムシートを閉じる

### 3.8 カテゴリ管理

**デフォルトカテゴリ（初回起動時に自動作成）**:

| カテゴリ名 | 色 | 用途 |
|-----------|---|------|
| Work（仕事） | 青 | 業務関連の活動 |
| Study（勉強） | 緑 | 学習・研究活動 |
| Exercise（運動） | オレンジ | 運動・トレーニング |
| Hobby（趣味） | 紫 | 趣味・娯楽活動 |
| Sleep（睡眠） | グレー | 睡眠時間 |
| Meal（食事） | 濃いオレンジ | 食事時間 |
| Other（その他） | 薄いグレー | その他の活動 |

**カテゴリの役割**:
- イベントの色分け（視覚的な識別）
- ドロップダウンでの選択肢として表示
- 表示順序の制御

---

## 4. レポート画面仕様

### 4.1 画面レイアウト

```
┌─────────────────────────────────────┐
│ AI Feedback                         │  ← トップバー
├─────────────────────────────────────┤
│                                     │
│    (画面の状態に応じたコンテンツ)    │
│                                     │
└─────────────────────────────────────┘
```

### 4.2 画面の4つの状態

#### 状態1: Initial（初期状態）

**表示内容**:

```
┌─────────────────────────────────────┐
│                                     │
│         ✨                          │
│                                     │
│   AI will analyze your day          │
│ Compare plans with actual results   │
│  and get feedback in KPT format.    │
│                                     │
│    [✨ Generate Feedback]           │
│                                     │
└─────────────────────────────────────┘
```

- アイコン: 星マーク（サイズ大、プライマリ色）
- 説明文: 3行のテキスト
- ボタン: "Generate Feedback"（画面幅の70%）

**ボタン操作**:
- タップで AI 分析を開始
- Loading 状態に遷移

#### 状態2: Loading（分析中）

**表示内容**:

```
┌─────────────────────────────────────┐
│                                     │
│          ⟳                          │
│                                     │
│  AI is generating feedback...       │
│                                     │
└─────────────────────────────────────┘
```

- スピナー（円形プログレスインジケーター）
- メッセージ: "AI is generating feedback..."

#### 状態3: Success（分析完了）

**表示内容**:

```
┌─────────────────────────────────────┐
│ 💡 AI Assistant          2026-02-08 │
│ Brief summary of your day based on  │
│ the analysis of planned vs actual.  │
├─────────────────────────────────────┤
│ 💡 KPT Analysis Report              │
├─────────────────────────────────────┤
│ ✓ Keep Title                        │
│ What went well and should continue  │
│ doing...                            │
├─────────────────────────────────────┤
│ ⚠ Problem Title                     │
│ What needs improvement and why...   │
├─────────────────────────────────────┤
│ ✨ Try Title                         │
│ Specific action plan for next step..│
└─────────────────────────────────────┘
```

**AI アシスタントカード**:
- アイコン: 電球マーク（丸い背景付き）
- タイトル: "AI Assistant"（太字）
- 日付: 対象日（右側表示）
- 要約: 1日の全体的なサマリー（2～3行）

**KPT 分析カード（3枚）**:

1. **Keep カード**（緑色）
   - アイコン: チェックマーク
   - タイトル: "Keep (What went well)"
   - 説明: 続けるべき良い習慣の詳細

2. **Problem カード**（オレンジ色）
   - アイコン: 警告マーク
   - タイトル: "Problem (Challenges)"
   - 説明: 改善すべき問題点の詳細

3. **Try カード**（青色）
   - アイコン: 星マーク
   - タイトル: "Try (Action Plan)"
   - 説明: 次に試すべきアクションプランの詳細

**カードデザイン**:
- 角丸の矩形カード
- 左側にアイコン（丸い背景付き）
- タイトルは太字
- 説明文は通常フォント

#### 状態4: Error（エラー発生）

**表示内容**:

```
┌─────────────────────────────────────┐
│                                     │
│      An error occurred              │
│                                     │
│ [エラーメッセージ]                   │
│                                     │
│         [Retry]                     │
│                                     │
└─────────────────────────────────────┘
```

- エラー見出し: "An error occurred"（赤色）
- エラーメッセージ: 具体的なエラー内容
- ボタン: "Retry"（枠線ボタン）

**ボタン操作**:
- タップで再度 AI 分析を実行
- Loading 状態に遷移

### 4.3 AI分析の実行

**分析対象**:
- 対象日: 現在の日付
- 計画データ: 対象日のPlannedEvent一覧
- 実績データ: 対象日のLogEvent一覧

**データフォーマット**:

計画イベント:
```
- 09:00 - 10:00: [Work] Team meeting
- 11:00 - 12:00: [Study] JavaScript tutorial
```

実績ログ:
```
- 09:05 - 10:30: [Work] Email and team meeting
- 11:15 - 12:45: [Study] React documentation
```

**分析プロセス**:
1. ユーザーが "Generate Feedback" をタップ
2. 計画と実績データを収集
3. AI分析リクエストを送信
4. KPT形式のフィードバックを受信
5. 画面に結果を表示

**KPT形式の出力**:
- **Summary**: 全体的な1日の評価（50～100文字）
- **Keep**: 続けるべき行動（タイトル + 詳細説明）
- **Problem**: 改善すべき課題（タイトル + 詳細説明）
- **Try**: 次に試すアクション（タイトル + 詳細説明）

---

## 5. データモデル

### 5.1 LogEvent（実績ログ）

**属性**:
- ID: 一意識別子
- 活動名: イベントの内容
- カテゴリ: 関連付けられたカテゴリ
- 開始日時: イベント開始の日時
- 終了日時: イベント終了の日時（実行中の場合はnull）
- メモ: 追加の詳細情報

**用途**:
- 実際に行った活動の記録
- タイムライングリッドの「Log」列に表示

### 5.2 PlannedEvent（計画イベント）

**属性**:
- ID: 一意識別子
- 活動名: イベントの内容
- カテゴリ: 関連付けられたカテゴリ
- 開始日時: イベント開始予定の日時
- 終了日時: イベント終了予定の日時
- メモ: 追加の詳細情報
- 繰り返しルール: 定期的なイベントの設定（オプション）
- 終日フラグ: 終日イベントかどうか
- データソース: 手動入力 / 外部カレンダー連携
- アクティブフラグ: 論理削除用

**用途**:
- 予定している活動の記録
- タイムライングリッドの「Schedule」列に表示

### 5.3 Category（カテゴリ）

**属性**:
- ID: 一意識別子
- カテゴリ名: 表示名
- 色: ARGB形式の色コード
- 表示順序: ドロップダウンでの表示順

**用途**:
- イベントの分類と色分け
- ドロップダウンメニューでの選択肢

### 5.4 AiFeedback（AI分析結果）

**属性**:
- ID: 一意識別子
- 対象日: 分析対象の日付
- Summary: 全体概要
- Keep: 続けること（タイトル + 説明）
- Problem: 問題点（タイトル + 説明）
- Try: 次に試すこと（タイトル + 説明）

**用途**:
- レポート画面での表示
- 過去の分析結果の再利用（キャッシング）

---

## 6. ユーザー操作フロー

### 6.1 新規ログイベントの作成

```
1. タイムライン画面を表示
2. 空きスロット（1時間単位）を長押し
3. ボトムシート（Create Log）が開く
   - 開始時刻: 押したスロットの時刻で初期化
   - 終了時刻: 1時間後で初期化
4. Activity（活動名）を入力
5. Category（カテゴリ）を選択
6. Start Time（開始時刻）を調整（必要に応じて）
7. End Time（終了時刻）を調整（必要に応じて）
8. Memo（メモ）を入力（オプション）
9. "Create" ボタンをタップ
10. ボトムシートが閉じる
11. タイムライングリッドに新しいブロックが表示される
```

### 6.2 既存イベントの編集

```
1. タイムライン画面を表示
2. 編集したいイベントブロックをタップ
3. ボトムシート（Edit Log/Planned）が開く
   - 既存のデータが入力された状態
4. 変更したいフィールドを編集
5. "Save" ボタンをタップ
6. ボトムシートが閉じる
7. タイムライングリッドのブロックが更新される
```

### 6.3 イベントの削除

```
1. タイムライン画面を表示
2. 削除したいイベントブロックをタップ
3. ボトムシート（Edit）が開く
4. "Delete" ボタンをタップ
5. ボトムシートが閉じる
6. タイムライングリッドからブロックが削除される
```

### 6.4 日付の変更

```
1. タイムライン画面を表示
2. 週カレンダーを左右にスワイプ（前週/次週に移動）
3. 表示したい日付をタップ
4. タイムライングリッドが選択した日付のデータに更新される
5. トップバーの月・年表示が更新される
```

### 6.5 AI分析の実行

```
1. レポート画面に遷移（ボトムナビゲーションから）
2. "Generate Feedback" ボタンをタップ
3. Loading状態に遷移（スピナー表示）
4. AI分析が完了
5. Success状態に遷移
6. AIアシスタントカードとKPTカードが表示される
```

### 6.6 AI分析のリトライ

```
1. レポート画面でエラーが発生（Error状態）
2. エラーメッセージを確認
3. "Retry" ボタンをタップ
4. Loading状態に遷移
5. AI分析が完了
6. Success状態に遷移
```

---

## 7. バリデーションルール

### 7.1 イベント作成・編集のバリデーション

| 項目 | ルール | 違反時の動作 |
|------|--------|------------|
| Activity | 空白不可（必須入力） | "Create/Save"ボタンが無効化 |
| Category | 必ず選択（null不可） | "Create/Save"ボタンが無効化 |
| Start Time | 終了時刻より前である必要 | 終了時刻を自動調整 |
| End Time | 開始時刻より後である必要 | 自動調整により維持 |
| Memo | 任意（空白可） | - |

### 7.2 LogEventの特殊ルール

| ルール | 説明 |
|--------|------|
| 最小期間 | 1分以上の期間が必要 |
| 実行中イベント | 終了時刻がnullの場合、タイマー実行中とみなす |
| 重複タイマー | 同時に実行中のタイマーは1つまで |

### 7.3 時刻調整の自動処理

**開始時刻を変更した場合**:
- 新しい開始時刻 > 終了時刻の場合
  - 終了時刻を開始時刻と同じ値に自動更新

**終了時刻を変更した場合**:
- 新しい終了時刻 < 開始時刻の場合
  - ダイアログが閉じず、ユーザーに再選択を促す
  - または、自動調整により開始時刻と同じ値に設定

---

## 8. エラーハンドリング

### 8.1 レポート画面のエラー

| エラー種別 | 表示メッセージ | 対応方法 |
|-----------|--------------|---------|
| API接続エラー | "An error occurred\n[ネットワークエラーメッセージ]" | Retryボタンで再実行 |
| 認証エラー | "An error occurred\n[認証エラーメッセージ]" | Retryボタンで再実行 |
| その他のエラー | "An error occurred\n[エラーメッセージ]" | Retryボタンで再実行 |

### 8.2 タイムライン画面のエラー

| エラー種別 | 表示 | 対応方法 |
|-----------|------|---------|
| データ読み込みエラー | "エラー: [メッセージ]" | 画面を再読み込み |

### 8.3 エラー表示の仕様

**レポート画面**:
- Error状態に遷移
- エラーメッセージを中央に表示
- "Retry"ボタンを表示
- タップで再実行

**タイムライン画面**:
- エラーテキストを画面中央に表示
- 赤色で表示

---

## 9. 画面の初期状態

### 9.1 タイムライン画面の初期表示

**初回起動時**:
- デフォルトカテゴリ7個を自動作成
- 現在の日付を選択
- 空のタイムライングリッドを表示

**2回目以降の起動時**:
- 現在の日付を選択
- 現在の日付のイベントを表示

### 9.2 レポート画面の初期表示

**初回表示時**:
- Initial状態を表示
- 対象日: 現在の日付
- "Generate Feedback"ボタンを表示

**フィードバック生成後**:
- Success状態を表示
- キャッシュされたフィードバックを表示（同じ日付の場合）

---

## 10. UI仕様の詳細

### 10.1 色の使用

**プライマリ色**:
- 選択中の日付背景
- アクティブなボタン
- アクセントカラー

**カテゴリ色**:
- イベントブロックの背景（透明度30%）
- イベントブロックの左フチ（濃い色）
- ラベルテキスト（50%暗く）

**KPTカード色**:
- Keep: 緑系統
- Problem: オレンジ系統
- Try: 青系統

### 10.2 フォントサイズ

| 要素 | サイズ | 太さ |
|------|--------|------|
| 画面タイトル | 大 | 太字 |
| セクションタイトル | 中 | 太字 |
| 本文 | 中 | 通常 |
| 補足テキスト | 小 | 通常 |
| 時刻ラベル | 小 | 通常 |

### 10.3 スペーシング

| 要素 | 余白 |
|------|------|
| 画面の端 | 16dp |
| セクション間 | 16dp |
| カード間 | 16dp |
| フィールド間 | 12dp |
| テキスト行間 | 4dp |

### 10.4 アニメーション

| 要素 | アニメーション | 効果 |
|------|-------------|------|
| 日付選択 | 背景色の変化 | スムーズな遷移 |
| 日付選択 | スケール変化 | 0.95 → 1.0 |
| スロット長押し | 背景色の変化 | 薄いプライマリ色 |
| ボトムシート | スライドアップ | 下から上にスライド |

---

## 11. 制約事項

### 11.1 現在の制約

1. **外部カレンダー連携**: 未実装
   - Apple Calendar連携なし
   - Google Calendar連携なし

2. **繰り返しイベント**: 部分的実装
   - 月次繰り返しの「月末」指定未対応

3. **データ同期**: 未実装
   - クラウド同期機能なし
   - マルチデバイス間のデータ共有不可

4. **通知機能**: 未実装
   - 予定イベントのリマインダーなし

5. **データエクスポート**: 未実装
   - CSV出力なし
   - PDF出力なし

6. **AI分析モード**: 未実装
   - フィードバックトーンの切り替え（優しい/普通/厳しい）なし

7. **タイムゾーン**: 固定
   - ユーザーのローカルタイムゾーンのみ対応

### 11.2 既知の問題

1. **AI応答エラー**: JSONパースに失敗した場合のフォールバック処理なし
2. **長時間イベント**: 24時間を超えるイベントの表示未対応
3. **同時イベント**: 同じ時間帯の複数イベントは重なって表示される

---

## 12. 将来の拡張計画

### 12.1 機能拡張

- **週次/月次レポート**: 複数日のデータを集計して統計表示
- **カスタムKPI**: ユーザー定義の指標追跡
- **外部カレンダー連携**: Apple Calendar / Google Calendar との同期
- **データエクスポート**: CSV / PDF 形式でのデータ出力
- **通知・リマインダー**: 予定イベントの事前通知
- **ダークモード**: 暗い配色テーマの追加
- **カテゴリのカスタマイズ**: ユーザーが自由にカテゴリを作成・編集

### 12.2 UI/UX改善

- **複数イベントの重なり表示**: 同時間帯のイベントを横並びで表示
- **ドラッグ&ドロップ**: イベントブロックをドラッグして時刻変更
- **長時間イベント**: 日をまたぐイベントの適切な表示
- **検索機能**: 過去のイベントを検索
- **フィルター機能**: カテゴリ別の表示/非表示

---

## 13. 用語集

| 用語 | 説明 |
|------|------|
| **LogEvent** | 実際に行った活動の記録（実績） |
| **PlannedEvent** | 予定している活動の記録（計画） |
| **TimeBlock** | タイムライングリッド上のイベント表示ブロック |
| **KPT** | Keep-Problem-Try の振り返りフレームワーク |
| **Category** | イベントを分類するためのラベルと色 |
| **ボトムシート** | 画面下部から表示される入力フォーム |
| **週カレンダー** | 7日間の日付を横並びで表示するカレンダー |

---

**補足**: この仕様書は実装の詳細に依存しない、機能要件とUI/UX仕様に焦点を当てた文書です。技術的な実装方法については別途技術設計書を参照してください。
